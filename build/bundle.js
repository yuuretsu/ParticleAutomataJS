var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function l(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function r(e,n,o){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}(n,o))}function i(t,e){t.appendChild(e)}function c(t,e,n){t.insertBefore(e,n||null)}function u(t){t.parentNode.removeChild(t)}function a(t){return document.createElement(t)}function f(t){return document.createTextNode(t)}function d(){return f(" ")}function h(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function p(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function m(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function y(t,e){t.value=null==e?"":e}function g(t,e,n){t.classList[n?"add":"remove"](e)}let $;function x(t){$=t}function b(t){(function(){if(!$)throw new Error("Function called outside component initialization");return $})().$$.after_update.push(t)}function v(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach((t=>t.call(this,e)))}const w=[],k=[],_=[],M=[],C=Promise.resolve();let j=!1;function E(t){_.push(t)}function S(t){M.push(t)}let q=!1;const A=new Set;function I(){if(!q){q=!0;do{for(let t=0;t<w.length;t+=1){const e=w[t];x(e),N(e.$$)}for(x(null),w.length=0;k.length;)k.pop()();for(let t=0;t<_.length;t+=1){const e=_[t];A.has(e)||(A.add(e),e())}_.length=0}while(w.length);for(;M.length;)M.pop()();j=!1,q=!1,A.clear()}}function N(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(E)}}const O=new Set;let T;function P(t,e){t&&t.i&&(O.delete(t),t.i(e))}function z(t,e,n,o){if(t&&t.o){if(O.has(t))return;O.add(t),T.c.push((()=>{O.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}const L="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function F(t,e,n){const o=t.$$.props[e];void 0!==o&&(t.$$.bound[o]=n,n(t.$$.ctx[o]))}function H(t){t&&t.c()}function W(t,n,s,r){const{fragment:i,on_mount:c,on_destroy:u,after_update:a}=t.$$;i&&i.m(n,s),r||E((()=>{const n=c.map(e).filter(l);u?u.push(...n):o(n),t.$$.on_mount=[]})),a.forEach(E)}function B(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function D(t,e){-1===t.$$.dirty[0]&&(w.push(t),j||(j=!0,C.then(I)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function G(e,l,s,r,i,c,a,f=[-1]){const d=$;x(e);const h=e.$$={fragment:null,ctx:null,props:c,update:t,not_equal:i,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:l.context||[]),callbacks:n(),dirty:f,skip_bound:!1,root:l.target||d.$$.root};a&&a(h.root);let p=!1;if(h.ctx=s?s(e,l.props||{},((t,n,...o)=>{const l=o.length?o[0]:n;return h.ctx&&i(h.ctx[t],h.ctx[t]=l)&&(!h.skip_bound&&h.bound[t]&&h.bound[t](l),p&&D(e,t)),n})):[],h.update(),p=!0,o(h.before_update),h.fragment=!!r&&r(h.ctx),l.target){if(l.hydrate){const t=function(t){return Array.from(t.childNodes)}(l.target);h.fragment&&h.fragment.l(t),t.forEach(u)}else h.fragment&&h.fragment.c();l.intro&&P(e.$$.fragment),W(e,l.target,l.anchor,l.customElement),I()}x(d)}class R{$destroy(){B(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function X(e){let n,o,l;return{c(){n=a("canvas"),p(n,"width",e[0]),p(n,"height",e[1]),p(n,"class","svelte-6utq4t")},m(t,s){c(t,n,s),e[10](n),o||(l=h(n,"click",e[9]),o=!0)},p(t,[e]){1&e&&p(n,"width",t[0]),2&e&&p(n,"height",t[1])},i:t,o:t,d(t){t&&u(n),e[10](null),o=!1,l()}}}function Y(t,e,n){let o,{width:l}=e,{height:s}=e,{links:r}=e,{fields:i}=e,{fw:c}=e,{fh:u}=e,{r:a}=e,{colors:f}=e;return b((()=>{const t=o.getContext("2d");t.fillStyle="black",t.fillRect(0,0,l,s);for(let e=0;e<r.length;e++){const n=r[e].a,o=r[e].b;t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(o.x,o.y);const l=t.createLinearGradient(n.x,n.y,o.x,o.y);l.addColorStop(0,f[n.type]),l.addColorStop(1,f[o.type]),t.strokeStyle=l,t.lineWidth=Math.max(10-Math.hypot(n.x-o.x,n.y-o.y)/4,2),t.stroke()}for(let o=0;o<c;o++)for(let l=0;l<u;l++){const s=i[o][l];for(let o=0;o<s.length;o++){const l=s[o];e=l.x,n=l.y,d=l.type,t.fillStyle=f[d]||"white",t.beginPath(),t.arc(e,n,a,0,2*Math.PI),t.fill()}}var e,n,d})),t.$$set=t=>{"width"in t&&n(0,l=t.width),"height"in t&&n(1,s=t.height),"links"in t&&n(3,r=t.links),"fields"in t&&n(4,i=t.fields),"fw"in t&&n(5,c=t.fw),"fh"in t&&n(6,u=t.fh),"r"in t&&n(7,a=t.r),"colors"in t&&n(8,f=t.colors)},[l,s,o,r,i,c,u,a,f,function(e){v.call(this,t,e)},function(t){k[t?"unshift":"push"]((()=>{o=t,n(2,o)}))}]}class J extends R{constructor(t){super(),G(this,t,Y,X,s,{width:0,height:1,links:3,fields:4,fw:5,fh:6,r:7,colors:8})}}function K(e){let n,l,s,r,g,$,x,b,v;return{c(){n=a("label"),l=a("div"),s=f(e[1]),r=f(": "),g=f(e[0]),$=d(),x=a("input"),p(l,"class","svelte-i58ql1"),p(x,"type","range"),p(x,"min",e[2]),p(x,"max",e[3]),p(x,"step",e[4]),p(x,"class","svelte-i58ql1"),p(n,"class","wrapper svelte-i58ql1")},m(t,o){c(t,n,o),i(n,l),i(l,s),i(l,r),i(l,g),i(n,$),i(n,x),y(x,e[0]),b||(v=[h(x,"change",e[5]),h(x,"input",e[5])],b=!0)},p(t,[e]){2&e&&m(s,t[1]),1&e&&m(g,t[0]),4&e&&p(x,"min",t[2]),8&e&&p(x,"max",t[3]),16&e&&p(x,"step",t[4]),1&e&&y(x,t[0])},i:t,o:t,d(t){t&&u(n),b=!1,o(v)}}}function Q(t,e,n){let{name:o}=e,{min:l=0}=e,{max:s=100}=e,{value:r=l}=e,{step:i=1}=e;return t.$$set=t=>{"name"in t&&n(1,o=t.name),"min"in t&&n(2,l=t.min),"max"in t&&n(3,s=t.max),"value"in t&&n(0,r=t.value),"step"in t&&n(4,i=t.step)},[r,o,l,s,i,function(){r=function(t){return""===t?null:+t}(this.value),n(0,r)}]}class U extends R{constructor(t){super(),G(this,t,Q,K,s,{name:1,min:2,max:3,value:0,step:4})}}function V(t,e,n){const o=t.slice();return o[3]=e[n],o}function Z(t){let e,n,o,l;function s(){return t[2](t[3])}return{c(){e=a("button"),p(e,"name","color"),p(e,"type","radio"),p(e,"style",n=`background-color: ${t[3][1]};`),p(e,"class","svelte-5i7tqo"),g(e,"selected",t[0]===t[3][0])},m(t,n){c(t,e,n),o||(l=h(e,"click",s),o=!0)},p(o,l){t=o,2&l&&n!==(n=`background-color: ${t[3][1]};`)&&p(e,"style",n),3&l&&g(e,"selected",t[0]===t[3][0])},d(t){t&&u(e),o=!1,l()}}}function tt(e){let n,o=Array(...e[1].entries()),l=[];for(let t=0;t<o.length;t+=1)l[t]=Z(V(e,o,t));return{c(){n=a("div");for(let t=0;t<l.length;t+=1)l[t].c();p(n,"class","wrapper svelte-5i7tqo")},m(t,e){c(t,n,e);for(let t=0;t<l.length;t+=1)l[t].m(n,null)},p(t,[e]){if(3&e){let s;for(o=Array(...t[1].entries()),s=0;s<o.length;s+=1){const r=V(t,o,s);l[s]?l[s].p(r,e):(l[s]=Z(r),l[s].c(),l[s].m(n,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=o.length}},i:t,o:t,d(t){t&&u(n),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(l,t)}}}function et(t,e,n){let{colors:o=[]}=e,{selectedId:l=0}=e;return t.$$set=t=>{"colors"in t&&n(1,o=t.colors),"selectedId"in t&&n(0,l=t.selectedId)},[l,o,t=>n(0,l=t[0])]}class nt extends R{constructor(t){super(),G(this,t,et,tt,s,{colors:1,selectedId:0})}}const ot=[];const{window:lt}=L;function st(e){let n,o,l;return{c(){n=a("button"),n.textContent="Show settings"},m(t,s){c(t,n,s),o||(l=h(n,"click",e[27]),o=!0)},p:t,i:t,o:t,d(t){t&&u(n),o=!1,l()}}}function rt(t){let e,n,l,s,r,f,m,y,g,$,x,b,v,w,_,M,C,j,E,q,A,I,N,O,T,L,D,G,R,X,Y,J,K,Q,V,Z,tt,et;function ot(e){t[21](e)}let lt={name:"Simulations per frame",min:1,max:20};function st(e){t[22](e)}void 0!==t[9]&&(lt.value=t[9]),$=new U({props:lt}),k.push((()=>F($,"value",ot)));let rt={name:"Speed multiplier",min:1,max:40};function it(e){t[24](e)}void 0!==t[4]&&(rt.value=t[4]),v=new U({props:rt}),k.push((()=>F(v,"value",st)));let ct={name:"Colors",min:1,max:t[11].length};function ut(e){t[25](e)}void 0!==t[10]&&(ct.value=t[10]),I=new U({props:ct}),k.push((()=>F(I,"value",it)));let at={name:"Node count",min:0,max:5e3};function ft(e){t[26](e)}void 0!==t[3]&&(at.value=t[3]),T=new U({props:at}),k.push((()=>F(T,"value",ut)));let dt={colors:t[11].slice(0,t[6].length)};return void 0!==t[5]&&(dt.selectedId=t[5]),Q=new nt({props:dt}),k.push((()=>F(Q,"selectedId",ft))),{c(){e=a("div"),n=a("div"),l=a("button"),l.textContent="Hide settings",s=d(),r=a("button"),r.textContent="Copy link",f=d(),m=a("div"),y=a("h2"),y.textContent="Current world settings",g=d(),H($.$$.fragment),b=d(),H(v.$$.fragment),_=d(),M=a("div"),C=a("button"),C.textContent="Delete all particles",j=d(),E=a("div"),q=a("h2"),q.textContent="New world settings",A=d(),H(I.$$.fragment),O=d(),H(T.$$.fragment),D=d(),G=a("div"),R=a("button"),R.textContent="Create new world",X=d(),Y=a("div"),J=a("h2"),J.textContent="Particle brush",K=d(),H(Q.$$.fragment),p(l,"class","svelte-1jit4ry"),p(r,"class","svelte-1jit4ry"),p(n,"class","buttons-row svelte-1jit4ry"),p(e,"class","controls-block svelte-1jit4ry"),p(y,"class","controls-block__title svelte-1jit4ry"),p(C,"class","svelte-1jit4ry"),p(M,"class","buttons-row svelte-1jit4ry"),p(m,"class","controls-block svelte-1jit4ry"),p(q,"class","controls-block__title svelte-1jit4ry"),p(R,"class","svelte-1jit4ry"),p(G,"class","buttons-row svelte-1jit4ry"),p(E,"class","controls-block svelte-1jit4ry"),p(J,"class","controls-block__title svelte-1jit4ry"),p(Y,"class","controls-block svelte-1jit4ry")},m(o,u){c(o,e,u),i(e,n),i(n,l),i(n,s),i(n,r),c(o,f,u),c(o,m,u),i(m,y),i(m,g),W($,m,null),i(m,b),W(v,m,null),i(m,_),i(m,M),i(M,C),c(o,j,u),c(o,E,u),i(E,q),i(E,A),W(I,E,null),i(E,O),W(T,E,null),i(E,D),i(E,G),i(G,R),c(o,X,u),c(o,Y,u),i(Y,J),i(Y,K),W(Q,Y,null),Z=!0,tt||(et=[h(l,"click",t[20]),h(r,"click",t[16]),h(C,"click",t[23]),h(R,"click",t[15])],tt=!0)},p(t,e){const n={};!x&&512&e[0]&&(x=!0,n.value=t[9],S((()=>x=!1))),$.$set(n);const o={};!w&&16&e[0]&&(w=!0,o.value=t[4],S((()=>w=!1))),v.$set(o);const l={};!N&&1024&e[0]&&(N=!0,l.value=t[10],S((()=>N=!1))),I.$set(l);const s={};!L&&8&e[0]&&(L=!0,s.value=t[3],S((()=>L=!1))),T.$set(s);const r={};64&e[0]&&(r.colors=t[11].slice(0,t[6].length)),!V&&32&e[0]&&(V=!0,r.selectedId=t[5],S((()=>V=!1))),Q.$set(r)},i(t){Z||(P($.$$.fragment,t),P(v.$$.fragment,t),P(I.$$.fragment,t),P(T.$$.fragment,t),P(Q.$$.fragment,t),Z=!0)},o(t){z($.$$.fragment,t),z(v.$$.fragment,t),z(I.$$.fragment,t),z(T.$$.fragment,t),z(Q.$$.fragment,t),Z=!1},d(t){t&&u(e),t&&u(f),t&&u(m),B($),B(v),t&&u(j),t&&u(E),B(I),B(T),t&&u(X),t&&u(Y),B(Q),tt=!1,o(et)}}}function it(t){let e,n,l,s,r,f,m,y,$;E(t[18]),n=new J({props:{width:t[0],height:t[1],fields:t[8],links:t[7],fw:t[12],fh:t[13],r:ct,colors:t[11]}}),n.$on("click",t[19]);const x=[rt,st],b=[];function v(t,e){return t[2]?0:1}return r=v(t),f=b[r]=x[r](t),{c(){e=a("main"),H(n.$$.fragment),l=d(),s=a("div"),f.c(),p(s,"class","controls svelte-1jit4ry"),g(s,"controls_opened",t[2])},m(o,u){c(o,e,u),W(n,e,null),i(e,l),i(e,s),b[r].m(s,null),m=!0,y||($=h(lt,"resize",t[18]),y=!0)},p(t,e){const l={};1&e[0]&&(l.width=t[0]),2&e[0]&&(l.height=t[1]),256&e[0]&&(l.fields=t[8]),128&e[0]&&(l.links=t[7]),n.$set(l);let i=r;r=v(t),r===i?b[r].p(t,e):(T={r:0,c:[],p:T},z(b[i],1,1,(()=>{b[i]=null})),T.r||o(T.c),T=T.p,f=b[r],f?f.p(t,e):(f=b[r]=x[r](t),f.c()),P(f,1),f.m(s,null)),4&e[0]&&g(s,"controls_opened",t[2])},i(t){m||(P(n.$$.fragment,t),P(f),m=!0)},o(t){z(n.$$.fragment,t),z(f),m=!1},d(t){t&&u(e),B(n),b[r].d(),y=!1,$()}}}const ct=5;let ut=100;function at(t,e){t.splice(t.indexOf(e),1)}function ft(e,n,o){let l,i=window.innerWidth,c=window.innerHeight;let u=!0,a=750,f=4,d=0;const h=1e4;let p=i/ut+1,m=c/ut+1,y=3,g=[],$=[],x=[],b=[],v=[],w=function(e,n=t){let o;const l=new Set;function r(t){if(s(e,t)&&(e=t,o)){const t=!ot.length;for(const t of l)t[1](),ot.push(t,e);if(t){for(let t=0;t<ot.length;t+=2)ot[t][0](ot[t+1]);ot.length=0}}}return{set:r,update:function(t){r(t(e))},subscribe:function(s,i=t){const c=[s,i];return l.add(c),1===l.size&&(o=n(r)||t),s(e),()=>{l.delete(c),0===l.size&&(o(),o=null)}}}}(3);r(e,w,(t=>o(10,l=t)));let k=5;if(location.hash){let t=location.hash.substring(1).split("-"),e=0;_=w,l=~~t[e],M=l,_.set(M),y=l,C(),e++;for(let n=0;n<y;n++)g[n]=Number(t[e])>>2*n&3;e++;for(let n=0;n<y;n++){for(let o=0;o<y;o++)$[n][o]=(Number(t[e])>>2*o&3)-1;e++}for(let n=0;n<y;n++){for(let o=0;o<y;o++)x[n][o]=Number(t[e])>>2*o&3;e++}history.pushState(null,null," ")}else C();var _,M;function C(){o(5,d=0),function(){y=l,g=[],o(6,$=[]),x=[];for(let t=0;t<y;t++){g.push(~~(4*Math.random())),$.push([]),x.push([]);for(let e=0;e<y;e++)$[t].push(Math.floor(3*Math.random()-1)),x[t].push(~~(4*Math.random()))}}(),function(){o(7,b=[]),o(8,v=[]);for(let t=0;t<p;t++){v.push([]);for(let e=0;e<m;e++)v[t].push([])}for(let t=0;t<a;t++)j(Math.random()*i,Math.random()*c,~~(Math.random()*y))}()}function j(t,e,n){let o={x:t,y:e,type:n,sx:0,sy:0,bonds:[]};const l=Math.floor(t/ut),s=Math.floor(e/ut);v[l][s].push(o)}function E(t,e){const n=t.x-e.x,o=t.y-e.y;let l=n*n+o*o;if(l<h){let n=$[t.type][e.type]/l,o=$[e.type][t.type]/l;if(t.bonds.length<g[t.type]&&e.bonds.length<g[e.type]){if(l<2500&&-1===t.bonds.indexOf(e)&&-1===e.bonds.indexOf(t)){let n=0;t.bonds.forEach((t=>{t.type===e.type&&n++}));let o=0;e.bonds.forEach((e=>{e.type===t.type&&o++})),n<x[t.type][e.type]&&o<x[e.type][t.type]&&function(t,e){t.bonds.push(e),e.bonds.push(t),b.push({a:t,b:e})}(t,e)}}else-1===t.bonds.indexOf(e)&&-1===e.bonds.indexOf(t)&&(n=1/l,o=1/l);const s=Math.atan2(t.y-e.y,t.x-e.x);l<1&&(l=1),l<ct*ct*4&&(n=1/l,o=1/l),t.sx+=Math.cos(s)*n*f,t.sy+=Math.sin(s)*n*f,e.sx-=Math.cos(s)*o*f,e.sy-=Math.sin(s)*o*f}}function S(){for(let t=0;t<p;t++)for(let e=0;e<m;e++){const n=v[t][e];for(let t=0;t<n.length;t++){const e=n[t];e.x+=e.sx,e.y+=e.sy,e.sx*=.98,e.sy*=.98;const o=Math.sqrt(e.sx*e.sx+e.sy*e.sy);o>1&&(e.sx/=o,e.sy/=o),e.x<10?(e.sx+=.05*f,e.x<0&&(e.x=-e.x,e.sx*=-.5)):e.x>i-10&&(e.sx-=.05*f,e.x>i&&(e.x=2*i-e.x,e.sx*=-.5)),e.y<10?(e.sy+=.05*f,e.y<0&&(e.y=-e.y,e.sy*=-.5)):e.y>c-10&&(e.sy-=.05*f,e.y>c&&(e.y=2*c-e.y,e.sy*=-.5))}}for(let t=0;t<b.length;t++){const e=b[t],n=e.a,o=e.b,l=n.x-o.x,s=n.y-o.y;let r=l*l+s*s;if(r>2500)at(n.bonds,o),at(o.bonds,n),at(b,e),t--;else if(r>ct*ct*4){const t=Math.atan2(n.y-o.y,n.x-o.x),e=-.015;n.sx+=Math.cos(t)*e*f,n.sy+=Math.sin(t)*e*f,o.sx-=Math.cos(t)*e*f,o.sy-=Math.sin(t)*e*f}}for(let t=0;t<p;t++)for(let e=0;e<m;e++){const n=v[t][e];for(let o=0;o<n.length;o++){const l=n[o],s=Math.floor(l.x/ut),r=Math.floor(l.y/ut);s===t&&r===e||(at(n,l),v[s][r].push(l))}}for(let t=0;t<p;t++)for(let e=0;e<m;e++){const n=v[t][e];for(let o=0;o<n.length;o++){const l=n[o];for(let t=o+1;t<n.length;t++){E(l,n[t])}if(t<p-1){const n=v[t+1][e];for(let t=0;t<n.length;t++){E(l,n[t])}}if(e<m-1){const n=e+1,o=v[t][n];for(let t=0;t<o.length;t++){E(l,o[t])}if(t<p-1){const e=v[t+1][n];for(let t=0;t<e.length;t++){E(l,e[t])}}}}}}requestAnimationFrame((function t(){for(let t=0;t<k;t++)S();o(8,v=[...v]),window.requestAnimationFrame(t)}));return[i,c,u,a,f,d,$,b,v,k,l,["#fa1414","#c88c64","#50aa8c","#0096e6","#0a14e6","#8200c8","#fa96d2","#828282","green"],p,m,w,C,function(){let t="";t+=y;let e=0;for(let t=0;t<y;t++)e|=g[t]<<2*t;t+="-"+e;for(let e=0;e<y;e++){let n=0;for(let t=0;t<y;t++)n|=$[e][t]+1<<2*t;t+="-"+n}for(let e=0;e<y;e++){let n=0;for(let t=0;t<y;t++)n|=x[e][t]<<2*t;t+="-"+n}t=window.location.href+"#"+t;let n=document.createElement("input");n.value=t,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)},j,function(){o(0,i=lt.innerWidth),o(1,c=lt.innerHeight)},t=>{console.log("add"),j(t.clientX+Math.random()-.5,t.clientY+Math.random()-.5,d)},()=>o(2,u=!1),function(t){k=t,o(9,k)},function(t){f=t,o(4,f)},()=>{o(8,v=[]);for(let t=0;t<p;t++){v.push([]);for(let e=0;e<m;e++)v[t].push([])}o(7,b=[])},function(t){l=t,w.set(l)},function(t){a=t,o(3,a)},function(t){d=t,o(5,d)},()=>o(2,u=!0)]}return new class extends R{constructor(t){super(),G(this,t,ft,it,s,{},null,[-1,-1])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
