var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function l(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function r(e,n,o){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}(n,o))}function c(t,e){t.appendChild(e)}function i(t,e,n){t.insertBefore(e,n||null)}function u(t){t.parentNode.removeChild(t)}function f(t){return document.createElement(t)}function a(t){return document.createTextNode(t)}function d(){return a(" ")}function h(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function p(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function m(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function g(t,e){t.value=null==e?"":e}function $(t,e,n){t.classList[n?"add":"remove"](e)}let y;function x(t){y=t}function b(t){(function(){if(!y)throw new Error("Function called outside component initialization");return y})().$$.after_update.push(t)}function v(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach((t=>t.call(this,e)))}const w=[],k=[],_=[],M=[],C=Promise.resolve();let E=!1;function S(t){_.push(t)}function A(t){M.push(t)}let I=!1;const N=new Set;function O(){if(!I){I=!0;do{for(let t=0;t<w.length;t+=1){const e=w[t];x(e),q(e.$$)}for(x(null),w.length=0;k.length;)k.pop()();for(let t=0;t<_.length;t+=1){const e=_[t];N.has(e)||(N.add(e),e())}_.length=0}while(w.length);for(;M.length;)M.pop()();E=!1,I=!1,N.clear()}}function q(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(S)}}const T=new Set;let P;function z(t,e){t&&t.i&&(T.delete(t),t.i(e))}function L(t,e,n,o){if(t&&t.o){if(T.has(t))return;T.add(t),P.c.push((()=>{T.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}const j="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function F(t,e,n){const o=t.$$.props[e];void 0!==o&&(t.$$.bound[o]=n,n(t.$$.ctx[o]))}function H(t){t&&t.c()}function W(t,n,s,r){const{fragment:c,on_mount:i,on_destroy:u,after_update:f}=t.$$;c&&c.m(n,s),r||S((()=>{const n=i.map(e).filter(l);u?u.push(...n):o(n),t.$$.on_mount=[]})),f.forEach(S)}function B(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function G(t,e){-1===t.$$.dirty[0]&&(w.push(t),E||(E=!0,C.then(O)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function R(e,l,s,r,c,i,f,a=[-1]){const d=y;x(e);const h=e.$$={fragment:null,ctx:null,props:i,update:t,not_equal:c,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:l.context||[]),callbacks:n(),dirty:a,skip_bound:!1,root:l.target||d.$$.root};f&&f(h.root);let p=!1;if(h.ctx=s?s(e,l.props||{},((t,n,...o)=>{const l=o.length?o[0]:n;return h.ctx&&c(h.ctx[t],h.ctx[t]=l)&&(!h.skip_bound&&h.bound[t]&&h.bound[t](l),p&&G(e,t)),n})):[],h.update(),p=!0,o(h.before_update),h.fragment=!!r&&r(h.ctx),l.target){if(l.hydrate){const t=function(t){return Array.from(t.childNodes)}(l.target);h.fragment&&h.fragment.l(t),t.forEach(u)}else h.fragment&&h.fragment.c();l.intro&&z(e.$$.fragment),W(e,l.target,l.anchor,l.customElement),O()}x(d)}class X{$destroy(){B(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function Y(e){let n,o,l;return{c(){n=f("canvas"),p(n,"width",e[0]),p(n,"height",e[1]),p(n,"class","svelte-6utq4t")},m(t,s){i(t,n,s),e[10](n),o||(l=h(n,"click",e[9]),o=!0)},p(t,[e]){1&e&&p(n,"width",t[0]),2&e&&p(n,"height",t[1])},i:t,o:t,d(t){t&&u(n),e[10](null),o=!1,l()}}}function D(t,e,n){let o,{width:l}=e,{height:s}=e,{links:r}=e,{fields:c}=e,{fw:i}=e,{fh:u}=e,{r:f}=e,{colors:a}=e;return b((()=>{const t=o.getContext("2d");t.fillStyle="black",t.fillRect(0,0,l,s);for(let e=0;e<r.length;e++){const n=r[e].a,o=r[e].b;t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(o.x,o.y);const l=t.createLinearGradient(n.x,n.y,o.x,o.y);l.addColorStop(0,a[n.type]),l.addColorStop(1,a[o.type]),t.strokeStyle=l,t.lineWidth=3,t.stroke()}for(let o=0;o<i;o++)for(let l=0;l<u;l++){const s=c[o][l];for(let o=0;o<s.length;o++){const l=s[o];e=l.x,n=l.y,d=l.type,t.fillStyle=a[d]||"white",t.beginPath(),t.arc(e,n,f,0,2*Math.PI),t.fill()}}var e,n,d})),t.$$set=t=>{"width"in t&&n(0,l=t.width),"height"in t&&n(1,s=t.height),"links"in t&&n(3,r=t.links),"fields"in t&&n(4,c=t.fields),"fw"in t&&n(5,i=t.fw),"fh"in t&&n(6,u=t.fh),"r"in t&&n(7,f=t.r),"colors"in t&&n(8,a=t.colors)},[l,s,o,r,c,i,u,f,a,function(e){v.call(this,t,e)},function(t){k[t?"unshift":"push"]((()=>{o=t,n(2,o)}))}]}class J extends X{constructor(t){super(),R(this,t,D,Y,s,{width:0,height:1,links:3,fields:4,fw:5,fh:6,r:7,colors:8})}}function K(e){let n,l,s,r,$,y,x,b,v;return{c(){n=f("label"),l=f("div"),s=a(e[1]),r=a(": "),$=a(e[0]),y=d(),x=f("input"),p(l,"class","svelte-1939yhb"),p(x,"type","range"),p(x,"min",e[2]),p(x,"max",e[3]),p(x,"step",e[4]),p(x,"class","svelte-1939yhb"),p(n,"class","wrapper svelte-1939yhb")},m(t,o){i(t,n,o),c(n,l),c(l,s),c(l,r),c(l,$),c(n,y),c(n,x),g(x,e[0]),b||(v=[h(x,"change",e[5]),h(x,"input",e[5])],b=!0)},p(t,[e]){2&e&&m(s,t[1]),1&e&&m($,t[0]),4&e&&p(x,"min",t[2]),8&e&&p(x,"max",t[3]),16&e&&p(x,"step",t[4]),1&e&&g(x,t[0])},i:t,o:t,d(t){t&&u(n),b=!1,o(v)}}}function Q(t,e,n){let{name:o}=e,{min:l=0}=e,{max:s=100}=e,{value:r=l}=e,{step:c=1}=e;return t.$$set=t=>{"name"in t&&n(1,o=t.name),"min"in t&&n(2,l=t.min),"max"in t&&n(3,s=t.max),"value"in t&&n(0,r=t.value),"step"in t&&n(4,c=t.step)},[r,o,l,s,c,function(){r=function(t){return""===t?null:+t}(this.value),n(0,r)}]}class U extends X{constructor(t){super(),R(this,t,Q,K,s,{name:1,min:2,max:3,value:0,step:4})}}function V(t,e,n){const o=t.slice();return o[3]=e[n],o}function Z(t){let e,n,o,l;function s(){return t[2](t[3])}return{c(){e=f("button"),p(e,"name","color"),p(e,"type","radio"),p(e,"style",n=`background-color: ${t[3][1]};`),p(e,"class","svelte-5i7tqo"),$(e,"selected",t[0]===t[3][0])},m(t,n){i(t,e,n),o||(l=h(e,"click",s),o=!0)},p(o,l){t=o,2&l&&n!==(n=`background-color: ${t[3][1]};`)&&p(e,"style",n),3&l&&$(e,"selected",t[0]===t[3][0])},d(t){t&&u(e),o=!1,l()}}}function tt(e){let n,o=Array(...e[1].entries()),l=[];for(let t=0;t<o.length;t+=1)l[t]=Z(V(e,o,t));return{c(){n=f("div");for(let t=0;t<l.length;t+=1)l[t].c();p(n,"class","wrapper svelte-5i7tqo")},m(t,e){i(t,n,e);for(let t=0;t<l.length;t+=1)l[t].m(n,null)},p(t,[e]){if(3&e){let s;for(o=Array(...t[1].entries()),s=0;s<o.length;s+=1){const r=V(t,o,s);l[s]?l[s].p(r,e):(l[s]=Z(r),l[s].c(),l[s].m(n,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=o.length}},i:t,o:t,d(t){t&&u(n),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(l,t)}}}function et(t,e,n){let{colors:o=[]}=e,{selectedId:l=0}=e;return t.$$set=t=>{"colors"in t&&n(1,o=t.colors),"selectedId"in t&&n(0,l=t.selectedId)},[l,o,t=>n(0,l=t[0])]}class nt extends X{constructor(t){super(),R(this,t,et,tt,s,{colors:1,selectedId:0})}}const ot=[];const{window:lt}=j;function st(e){let n,o,l;return{c(){n=f("button"),n.textContent="Show settings"},m(t,s){i(t,n,s),o||(l=h(n,"click",e[26]),o=!0)},p:t,i:t,o:t,d(t){t&&u(n),o=!1,l()}}}function rt(t){let e,n,l,s,r,a,m,g,$,y,x,b,v,w,_,M,C,E,S,I,N,O,q,T,P,j,G,R,X,Y,D,J,K,Q,V,Z;function tt(e){t[21](e)}let et={name:"Simulations per frame",min:1,max:20};function ot(e){t[22](e)}void 0!==t[9]&&(et.value=t[9]),g=new U({props:et}),k.push((()=>F(g,"value",tt)));let lt={name:"Speed multiplier",min:1,max:40};function st(e){t[23](e)}void 0!==t[4]&&(lt.value=t[4]),x=new U({props:lt}),k.push((()=>F(x,"value",ot)));let rt={name:"Colors",min:1,max:t[11].length};function ct(e){t[24](e)}void 0!==t[10]&&(rt.value=t[10]),I=new U({props:rt}),k.push((()=>F(I,"value",st)));let it={name:"Node count",min:0,max:5e3};function ut(e){t[25](e)}void 0!==t[3]&&(it.value=t[3]),q=new U({props:it}),k.push((()=>F(q,"value",ct)));let ft={colors:t[11].slice(0,t[6].length)};return void 0!==t[5]&&(ft.selectedId=t[5]),J=new nt({props:ft}),k.push((()=>F(J,"selectedId",ut))),{c(){e=f("div"),n=f("div"),l=f("button"),l.textContent="Hide settings",s=d(),r=f("div"),a=f("h2"),a.textContent="Current world settings",m=d(),H(g.$$.fragment),y=d(),H(x.$$.fragment),v=d(),w=f("div"),_=f("button"),_.textContent="Copy link",M=d(),C=f("div"),E=f("h2"),E.textContent="New world settings",S=d(),H(I.$$.fragment),O=d(),H(q.$$.fragment),P=d(),j=f("div"),G=f("button"),G.textContent="Create new world",R=d(),X=f("div"),Y=f("h2"),Y.textContent="Particle brush",D=d(),H(J.$$.fragment),p(l,"class","svelte-ftnpmo"),p(n,"class","buttons-row svelte-ftnpmo"),p(e,"class","controls-block svelte-ftnpmo"),p(a,"class","controls-block__title svelte-ftnpmo"),p(_,"class","svelte-ftnpmo"),p(w,"class","buttons-row svelte-ftnpmo"),p(r,"class","controls-block svelte-ftnpmo"),p(E,"class","controls-block__title svelte-ftnpmo"),p(G,"class","svelte-ftnpmo"),p(j,"class","buttons-row svelte-ftnpmo"),p(C,"class","controls-block svelte-ftnpmo"),p(Y,"class","controls-block__title svelte-ftnpmo"),p(X,"class","controls-block svelte-ftnpmo")},m(o,u){i(o,e,u),c(e,n),c(n,l),i(o,s,u),i(o,r,u),c(r,a),c(r,m),W(g,r,null),c(r,y),W(x,r,null),c(r,v),c(r,w),c(w,_),i(o,M,u),i(o,C,u),c(C,E),c(C,S),W(I,C,null),c(C,O),W(q,C,null),c(C,P),c(C,j),c(j,G),i(o,R,u),i(o,X,u),c(X,Y),c(X,D),W(J,X,null),Q=!0,V||(Z=[h(l,"click",t[20]),h(_,"click",t[16]),h(G,"click",t[15])],V=!0)},p(t,e){const n={};!$&&512&e[0]&&($=!0,n.value=t[9],A((()=>$=!1))),g.$set(n);const o={};!b&&16&e[0]&&(b=!0,o.value=t[4],A((()=>b=!1))),x.$set(o);const l={};!N&&1024&e[0]&&(N=!0,l.value=t[10],A((()=>N=!1))),I.$set(l);const s={};!T&&8&e[0]&&(T=!0,s.value=t[3],A((()=>T=!1))),q.$set(s);const r={};64&e[0]&&(r.colors=t[11].slice(0,t[6].length)),!K&&32&e[0]&&(K=!0,r.selectedId=t[5],A((()=>K=!1))),J.$set(r)},i(t){Q||(z(g.$$.fragment,t),z(x.$$.fragment,t),z(I.$$.fragment,t),z(q.$$.fragment,t),z(J.$$.fragment,t),Q=!0)},o(t){L(g.$$.fragment,t),L(x.$$.fragment,t),L(I.$$.fragment,t),L(q.$$.fragment,t),L(J.$$.fragment,t),Q=!1},d(t){t&&u(e),t&&u(s),t&&u(r),B(g),B(x),t&&u(M),t&&u(C),B(I),B(q),t&&u(R),t&&u(X),B(J),V=!1,o(Z)}}}function ct(t){let e,n,l,s,r,a,m,g,y;S(t[18]),n=new J({props:{width:t[0],height:t[1],fields:t[8],links:t[7],fw:t[12],fh:t[13],r:it,colors:t[11]}}),n.$on("click",t[19]);const x=[rt,st],b=[];function v(t,e){return t[2]?0:1}return r=v(t),a=b[r]=x[r](t),{c(){e=f("main"),H(n.$$.fragment),l=d(),s=f("div"),a.c(),p(s,"class","controls svelte-ftnpmo"),$(s,"controls_opened",t[2])},m(o,u){i(o,e,u),W(n,e,null),c(e,l),c(e,s),b[r].m(s,null),m=!0,g||(y=h(lt,"resize",t[18]),g=!0)},p(t,e){const l={};1&e[0]&&(l.width=t[0]),2&e[0]&&(l.height=t[1]),256&e[0]&&(l.fields=t[8]),128&e[0]&&(l.links=t[7]),n.$set(l);let c=r;r=v(t),r===c?b[r].p(t,e):(P={r:0,c:[],p:P},L(b[c],1,1,(()=>{b[c]=null})),P.r||o(P.c),P=P.p,a=b[r],a?a.p(t,e):(a=b[r]=x[r](t),a.c()),z(a,1),a.m(s,null)),4&e[0]&&$(s,"controls_opened",t[2])},i(t){m||(z(n.$$.fragment,t),z(a),m=!0)},o(t){L(n.$$.fragment,t),L(a),m=!1},d(t){t&&u(e),B(n),b[r].d(),g=!1,y()}}}const it=5;let ut=75;function ft(t,e){t.splice(t.indexOf(e),1)}function at(e,n,o){let l,c=window.innerWidth,i=window.innerHeight;let u=!0,f=750,a=4,d=0;const h=5625,p=c/ut+1,m=i/ut+1;let g=3,$=[],y=[],x=[],b=[],v=[],w=function(e,n=t){let o;const l=new Set;function r(t){if(s(e,t)&&(e=t,o)){const t=!ot.length;for(const t of l)t[1](),ot.push(t,e);if(t){for(let t=0;t<ot.length;t+=2)ot[t][0](ot[t+1]);ot.length=0}}}return{set:r,update:function(t){r(t(e))},subscribe:function(s,c=t){const i=[s,c];return l.add(i),1===l.size&&(o=n(r)||t),s(e),()=>{l.delete(i),0===l.size&&(o(),o=null)}}}}(3);r(e,w,(t=>o(10,l=t)));let k=5;if(location.hash){let t=location.hash.substring(1).split("-"),e=0;_=w,l=~~t[e],M=l,_.set(M),g=l,C(),e++;for(let n=0;n<g;n++)$[n]=Number(t[e])>>2*n&3;e++;for(let n=0;n<g;n++){for(let o=0;o<g;o++)y[n][o]=(Number(t[e])>>2*o&3)-1;e++}for(let n=0;n<g;n++){for(let o=0;o<g;o++)x[n][o]=Number(t[e])>>2*o&3;e++}history.pushState(null,null," ")}else C();var _,M;function C(){o(5,d=0),function(){g=l,$=[],o(6,y=[]),x=[];for(let t=0;t<g;t++){$.push(~~(4*Math.random())),y.push([]),x.push([]);for(let e=0;e<g;e++)y[t].push(Math.floor(3*Math.random()-1)),x[t].push(~~(4*Math.random()))}}(),function(){o(7,b=[]),o(8,v=[]);for(let t=0;t<p;t++){v.push([]);for(let e=0;e<m;e++)v[t].push([])}for(let t=0;t<f;t++)E(Math.random()*c,Math.random()*i,~~(Math.random()*g))}()}function E(t,e,n){let o={x:t,y:e,type:n,sx:0,sy:0,bonds:[]};const l=Math.floor(t/ut),s=Math.floor(e/ut);v[l][s].push(o)}function S(t,e){const n=t.x-e.x,o=t.y-e.y;let l=n*n+o*o;if(l<h){let n=y[t.type][e.type]/l,o=y[e.type][t.type]/l;if(t.bonds.length<$[t.type]&&e.bonds.length<$[e.type]){if(l<1406.25&&-1===t.bonds.indexOf(e)&&-1===e.bonds.indexOf(t)){let n=0;t.bonds.forEach((t=>{t.type===e.type&&n++}));let o=0;e.bonds.forEach((e=>{e.type===t.type&&o++})),n<x[t.type][e.type]&&o<x[e.type][t.type]&&function(t,e){t.bonds.push(e),e.bonds.push(t),b.push({a:t,b:e})}(t,e)}}else-1===t.bonds.indexOf(e)&&-1===e.bonds.indexOf(t)&&(n=1/l,o=1/l);const s=Math.atan2(t.y-e.y,t.x-e.x);l<1&&(l=1),l<it*it*4&&(n=1/l,o=1/l),t.sx+=Math.cos(s)*n*a,t.sy+=Math.sin(s)*n*a,e.sx-=Math.cos(s)*o*a,e.sy-=Math.sin(s)*o*a}}function A(){for(let t=0;t<p;t++)for(let e=0;e<m;e++){const n=v[t][e];for(let t=0;t<n.length;t++){const e=n[t];e.x+=e.sx,e.y+=e.sy,e.sx*=.98,e.sy*=.98;const o=Math.sqrt(e.sx*e.sx+e.sy*e.sy);o>1&&(e.sx/=o,e.sy/=o),e.x<10?(e.sx+=.05*a,e.x<0&&(e.x=-e.x,e.sx*=-.5)):e.x>c-10&&(e.sx-=.05*a,e.x>c&&(e.x=2*c-e.x,e.sx*=-.5)),e.y<10?(e.sy+=.05*a,e.y<0&&(e.y=-e.y,e.sy*=-.5)):e.y>i-10&&(e.sy-=.05*a,e.y>i&&(e.y=2*i-e.y,e.sy*=-.5))}}for(let t=0;t<b.length;t++){const e=b[t],n=e.a,o=e.b,l=n.x-o.x,s=n.y-o.y;let r=l*l+s*s;if(r>1406.25)ft(n.bonds,o),ft(o.bonds,n),ft(b,e),t--;else if(r>it*it*4){const t=Math.atan2(n.y-o.y,n.x-o.x),e=-.015;n.sx+=Math.cos(t)*e*a,n.sy+=Math.sin(t)*e*a,o.sx-=Math.cos(t)*e*a,o.sy-=Math.sin(t)*e*a}}for(let t=0;t<p;t++)for(let e=0;e<m;e++){const n=v[t][e];for(let o=0;o<n.length;o++){const l=n[o],s=Math.floor(l.x/ut),r=Math.floor(l.y/ut);s===t&&r===e||(ft(n,l),v[s][r].push(l))}}for(let t=0;t<p;t++)for(let e=0;e<m;e++){const n=v[t][e];for(let o=0;o<n.length;o++){const l=n[o];for(let t=o+1;t<n.length;t++){S(l,n[t])}if(t<p-1){const n=v[t+1][e];for(let t=0;t<n.length;t++){S(l,n[t])}}if(e<m-1){const n=e+1,o=v[t][n];for(let t=0;t<o.length;t++){S(l,o[t])}if(t<p-1){const e=v[t+1][n];for(let t=0;t<e.length;t++){S(l,e[t])}}}}}}requestAnimationFrame((function t(){for(let t=0;t<k;t++)A();o(8,v=[...v]),window.requestAnimationFrame(t)}));return[c,i,u,f,a,d,y,b,v,k,l,["#fa1414","#c88c64","#50aa8c","#0096e6","#0a14e6","#8200c8","#fa96d2","#828282","green"],p,m,w,C,function(){let t="";t+=g;let e=0;for(let t=0;t<g;t++)e|=$[t]<<2*t;t+="-"+e;for(let e=0;e<g;e++){let n=0;for(let t=0;t<g;t++)n|=y[e][t]+1<<2*t;t+="-"+n}for(let e=0;e<g;e++){let n=0;for(let t=0;t<g;t++)n|=x[e][t]<<2*t;t+="-"+n}t=window.location.href+"#"+t;let n=document.createElement("input");n.value=t,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)},E,function(){o(0,c=lt.innerWidth),o(1,i=lt.innerHeight)},t=>{console.log("add"),E(t.clientX+Math.random()-.5,t.clientY+Math.random()-.5,d)},()=>o(2,u=!1),function(t){k=t,o(9,k)},function(t){a=t,o(4,a)},function(t){l=t,w.set(l)},function(t){f=t,o(3,f)},function(t){d=t,o(5,d)},()=>o(2,u=!0)]}return new class extends X{constructor(t){super(),R(this,t,at,ct,s,{},null,[-1,-1])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
